import org.springframework.web.reactive.function.client.WebClient;
import org.springframework.web.reactive.function.client.WebClientResponseException;
import org.springframework.web.util.UriComponentsBuilder;

import java.util.Base64;

public class OAuth2TokenClient {
    private static final String TOKEN_ENDPOINT = "https://example.com/oauth/token";
    private static final String CLIENT_ID = "your-client-id";
    private static final String CLIENT_SECRET = "your-client-secret";
    private static final String USERNAME = "your-username";
    private static final String PASSWORD = "your-password";
    private static final String SCOPE = "your-requested-scope";

    public static void main(String[] args) {
        WebClient webClient = WebClient.builder().build();

        String tokenEndpoint = UriComponentsBuilder.fromUriString(TOKEN_ENDPOINT)
                .queryParam("grant_type", "password")
                .queryParam("username", USERNAME)
                .queryParam("password", PASSWORD)
                .queryParam("scope", SCOPE)
                .build()
                .toUriString();

        String clientCredentials = Base64.getEncoder().encodeToString((CLIENT_ID + ":" + CLIENT_SECRET).getBytes());

        String accessToken = webClient.post()
                .uri(tokenEndpoint)
                .header("Authorization", "Basic " + clientCredentials)
                .retrieve()
                .bodyToMono(TokenResponse.class)
                .map(TokenResponse::getAccessToken)
                .block();

        System.out.println("Access Token: " + accessToken);
    }

    private static class TokenResponse {
        private String accessToken;

        public String getAccessToken() {
            return accessToken;
        }

        public void setAccessToken(String accessToken) {
            this.accessToken = accessToken;
        }
    }
}
