import org.springframework.web.reactive.function.BodyInserters;
import org.springframework.web.reactive.function.client.WebClient;
import org.springframework.web.util.UriComponentsBuilder;

public class OAuth2TokenRetriever {
    public String getAccessToken() {
        // Set up your OAuth 2.0 client configuration
        String clientId = "your-client-id";
        String clientSecret = "your-client-secret";
        String authorizationUrl = "https://example.com/oauth/authorize";
        String tokenUrl = "https://example.com/oauth/token";

        // Create WebClient
        WebClient webClient = WebClient.create();

        // Build the request body
        String grantType = "client_credentials";
        String scope = "your-requested-scope";
        String requestBody = UriComponentsBuilder.newInstance()
                .queryParam("grant_type", grantType)
                .queryParam("client_id", clientId)
                .queryParam("client_secret", clientSecret)
                .queryParam("scope", scope)
                .build()
                .encode()
                .toUriString();

        // Send the POST request to the token URL
        String response = webClient.post()
                .uri(tokenUrl)
                .header("Content-Type", "application/x-www-form-urlencoded")
                .body(BodyInserters.fromFormData(requestBody))
                .retrieve()
                .bodyToMono(String.class)
                .block();

        // Extract the access token from the response
        String accessToken = extractAccessToken(response);

        return accessToken;
    }

    private String extractAccessToken(String response) {
        // Extract the access token from the response based on the JSON structure
        // This implementation may vary depending on the OAuth 2.0 provider

        // Example: Assuming the response is in JSON format like {"access_token": "YOUR_ACCESS_TOKEN"}
        JsonObject jsonObject = JsonParser.parseString(response).getAsJsonObject();
        String accessToken = jsonObject.get("access_token").getAsString();

        return accessToken;
    }
}
